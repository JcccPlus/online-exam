<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>在线考试云平台</title>
    <link rel="icon" th:href="@{/images/logo.png}">
    <!-- Bootstrap core CSS -->
    <link type="text/css" th:href="@{/bootstrapv5/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/public.css}" rel="stylesheet">
    <style>
        .content .content-right .right-con .right-operation .title {
            float: left;
            margin-left: 40px;
        }

        .content .content-right .right-con .right-operation .title .title-con {
            line-height: 70px;
            margin: 0;
            cursor: pointer;
        }

        .page-link {
            padding: 0.3rem 2rem;
            font-size: 16px;
        }
    </style>
</head>

<body>
<div th:replace="~{common/tcommon::header}"></div>
<div class="content">
    <div th:replace="~{common/tcommon::sidebar(active='tmain4.html')}"></div>
    <div class="content-right">
        <div class="right-con">
            <div class="right-con">
                <div class="right-operation">
                    <div class="title">
                        <h5 class="title-con">考试列表</h5>
                    </div>
                    <div class="input-group mb-3" style="width:250px;float: right;right: 45px;top:17px;">
                        <input type="text" class="form-control" placeholder="班级名/课程名" aria-label="Recipient's username"
                               aria-describedby="button-addon2" th:value="${searchValue}" id="searchValue">
                        <button class="btn btn-outline-secondary" type="button" id="button-addon2" title="搜索"
                                onclick="getExamList(null,this)">
                            <svg t="1642870685872" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="3506"
                                 width="16" height="16">
                                <path d="M976.948381 946.888761 749.532905 719.473285c28.916587-32.756031 52.169173-69.64622 69.236897-109.999276 21.116947-49.925063 31.823799-102.94358 31.823799-157.581991s-10.706853-107.657952-31.823799-157.581991c-20.390399-48.208978-49.575092-91.498924-86.745666-128.668475s-80.46052-66.355267-128.668475-86.745666C553.430598 57.778938 500.413104 47.072085 445.773669 47.072085c-54.639434 0-107.657952 10.706853-157.581991 31.823799-48.207955 20.390399-91.498924 49.576115-128.668475 86.745666-37.169551 37.169551-66.355267 80.459496-86.745666 128.668475C51.66059 344.234065 40.953737 397.252583 40.953737 451.892017S51.66059 559.548946 72.777537 609.474009c20.390399 48.207955 49.576115 91.498924 86.745666 128.668475 37.169551 37.169551 80.46052 66.35629 128.668475 86.74669 49.925063 21.116947 102.94358 31.823799 157.581991 31.823799 54.639434 0 107.657952-10.706853 157.583015-31.823799 40.352033-17.067724 77.242222-40.320311 109.998253-69.236897l227.415476 227.415476c4.995781 4.995781 11.541871 7.492648 18.090007 7.492648s13.094226-2.496867 18.090007-7.492648C986.938919 973.07619 986.938919 956.878277 976.948381 946.888761zM445.773669 805.546639c-94.464465 0-183.275163-36.786835-250.071476-103.58417-66.796312-66.795289-103.583147-155.605987-103.583147-250.071476 0-94.464465 36.786835-183.275163 103.583147-250.071476 66.796312-66.796312 155.60701-103.583147 250.071476-103.583147s183.275163 36.786835 250.071476 103.583147c66.796312 66.796312 103.583147 155.60701 103.583147 250.071476 0 92.640933-35.400255 179.829691-99.768261 246.163469-1.515516 0.974188-2.953262 2.118244-4.278443 3.444449-1.325182 1.325182-2.469238 2.762927-3.443425 4.27742C625.602338 770.145361 538.41358 805.546639 445.773669 805.546639z"
                                      p-id="3507"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <hr style="margin: 0">
                <div class="right-list" style="padding: 0px 40px;">
                    <div style="color: #b2b2b2;margin: 200px auto;font-size: 23px;width: 431px"
                         th:if="${#lists.isEmpty(examList)}">暂无相关考试数据，请前往试卷管理生成...
                    </div>
                    <table class="table table-hover" th:if="${not #lists.isEmpty(examList)}">
                        <caption>
                            共 [[${pageInfo.getPages()}]] 页 [[${pageInfo.getTotal()}]] 条数据，当前为第
                            [[${pageInfo.getPageNum()}]]
                            页
                        </caption>
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">试卷名称</th>
                            <th scope="col">考试时间</th>
                            <th scope="col">截止时间</th>
                            <th scope="col">允许迟到</th>
                            <th scope="col">考试班级</th>
                            <th scope="col">所属课程</th>
                            <th scope="col">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="exam:${examList}">
                            <th scope="row" th:text="${pageInfo.startRow+examStat.index}"></th>
                            <td th:text="${exam.paper.name}"></td>
                            <td th:text="${#dates.format(exam.start,'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${#dates.format(exam.end,'yyyy-MM-dd HH:mm:ss')}"></td>
                            <td th:text="${exam.lateTime==0||exam.lateTime==null?'无限制':(exam.lateTime+'分钟')}"></td>
                            <td th:text="${exam.classes.name}"></td>
                            <td th:text="${exam.paper.course.name}"></td>
                            <td>
                                <div class="btn-group" role="group" aria-label="First group">
                                    <button class="btn btn-outline-secondary" title="查看考试详情及学生成绩" data-bs-toggle="modal"
                                            data-bs-target="#getModal"
                                            th:onclick="toPage([[@{/exam/list.html/}+${exam.code}]])">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-justify" viewBox="0 0 16 16">
                                            <path fill-rule="evenodd" d="M2 12.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5zm0-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z"/>
                                        </svg>
                                    </button>
                                    <button class="btn btn-outline-secondary" title="删除"
                                            th:onclick="delExam([[${exam.id}]],[[${exam.code}]])">
                                        <svg t="1643123690316" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                             xmlns="http://www.w3.org/2000/svg" p-id="2260"
                                             width="16" height="16">
                                            <path d="M742.4 944H281.6c-49.4 0-89.6-43.1-89.6-96V368h64v480c0 17.3 11.7 32 25.6 32h460.8c13.9 0 25.6-14.7 25.6-32V368h64v480c0 52.9-40.2 96-89.6 96z"
                                                  p-id="2261"></path>
                                            <path d="M384 368h64v416h-64zM592 368h64v416h-64zM64 224h896v64H64z"
                                                  p-id="2262"></path>
                                            <path d="M768 288H256V160c0-52.9 43.1-96 96-96h320c52.9 0 96 43.1 96 96v128z m-448-64h384v-64c0-17.6-14.4-32-32-32H352c-17.6 0-32 14.4-32 32v64z"
                                                  p-id="2263"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <nav aria-label="Page navigation example" th:if="${not #lists.isEmpty(examList)}">
                        <ul class="pagination justify-content-center" style="margin: 0;">
                            <li th:class="${pageInfo.isHasPreviousPage()?'page-item':'page-item disabled'}"
                                th:onclick="getExamList([[${pageInfo.getPrePage()}]],this)">
                                <a class="page-link" href="#">&laquo;</a>
                            </li>
                            <li th:class="${pageInfo.isFirstPage?'page-item disabled':'page-item'}"
                                th:onclick="getExamList([[${pageInfo.getFirstPage()}]],this)">
                                <a class="page-link" href="#">首页</a>
                            </li>
                            <li th:class="${pageInfo.isLastPage?'page-item disabled':'page-item'}"
                                th:onclick="getExamList([[${pageInfo.getLastPage()}]],this)">
                                <a class="page-link" href="#">末页</a>
                            </li>
                            <li th:class="${pageInfo.isHasNextPage()?'page-item':'page-item disabled'}"
                                th:onclick="getExamList([[${pageInfo.getNextPage()}]],this)">
                                <a class="page-link" href="#">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script th:src="@{/bootstrapv5/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/common.js}"></script>
<script>
    function getExamList(pageNum, obj) {
        if (!$(obj).hasClass('disabled')) {
            var searchValue = $("#searchValue").val();
            if (pageNum == null) {
                window.location.href = "[[@{/exam/search}]]" + "?searchValue=" + searchValue;
            } else {
                window.location.href = "[[@{/exam/search}]]" + "?searchValue=" + searchValue + "&pageNum=" + pageNum;
            }
        }
    }

    function delExam(id, code) {
        if (confirm("确定取消该考试吗？")) {
            $.post("[[@{/exam/delete}]]", {"examId": id, "code": code}, function (data) {
                if (data.code === 0) {
                    getExamList([[${pageInfo.getPageNum()}]], null);
                }else{
                    alert(data.msg);
                }
            }, "json");
        }
    }
</script>
</body>

</html>