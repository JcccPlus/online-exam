<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>在线考试云平台</title>
    <link rel="icon" th:href="@{/images/logo.png}">
    <!-- Bootstrap core CSS -->
    <link type="text/css" th:href="@{/bootstrapv5/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/dashboard.css}" rel="stylesheet">
    <link th:href="@{/css/common.css}" rel="stylesheet">
    <link th:href="@{/css/public.css}" rel="stylesheet">
    <style>
        .content .content-right .right-con .right-operation .title {
            float: left;
            margin-left: 40px;
        }

        .content .content-right .right-con .right-operation .title .title-con {
            line-height: 70px;
            margin: 0;
            cursor: pointer;
        }

        .page-link {
            padding: 0.3rem 2rem;
            font-size: 16px;
        }

        .mb-3 a {
            position: relative;
            top: -2px;
            left: 81%;
        }

        .mb-3 h6 {
            display: inline-block;
        }

        .new_select_div .mb-3 {
            width: 23%;
            display: inline-block;
            margin-left: 16px;
        }

        .new_title_div .mb-3 {
            width: 97.3%;
            margin-left: 15px;
        }

        .new_opts_div .mb-3 {
            width: 48%;
            display: inline-block;
            margin-left: 14px;
        }

        .new_answer_div .mb-3 {
            width: 97.3%;
            margin-left: 15px;
        }

        #new_topic_form hr {
            height: 5px;
        }

        .new_select_div a{
            position: relative;
            top: -85px;
            left: 97.3%;
        }
    </style>
</head>

<body>
<div th:replace="~{common/tcommon::header}"></div>
<div class="content">
    <div th:replace="~{common/tcommon::sidebar(active='tmain2.html')}"></div>
    <div class="content-right">
        <div class="right-con">
            <div class="right-con">
                <div class="right-operation">
                    <div class="title">
                        <h5 class="title-con">我的题库</h5>
                    </div>
                    <div class="input-group mb-3" style="width:668px;float: right;right: 45px;top:17px;">
                        <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#addModal"
                                title="新增题目">
                            <svg t="1643124208177" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="2073"
                                 width="18" height="18">
                                <path d="M801.171 483.589H544V226.418c0-17.673-14.327-32-32-32s-32 14.327-32 32v257.171H222.83c-17.673 0-32 14.327-32 32s14.327 32 32 32H480v257.17c0 17.673 14.327 32 32 32s32-14.327 32-32v-257.17h257.171c17.673 0 32-14.327 32-32s-14.327-32-32-32z"
                                      fill="" p-id="2074"></path>
                            </svg>
                        </button>
                        <input class="form-control" list="courseListOptions" id="courseList" placeholder="请选择课程"
                               style="width: 100px;" th:value="${searchValue.getCourseName()}">
                        <datalist id="courseListOptions">
                            <option th:each="course:${courseList}" th:value="${course.name}"
                                    th:data-value="${course.id+'&'+course.code}"
                                    th:selected="${searchValue.getCourseId()==course.id}"></option>
                        </datalist>
                        <input class="form-control" list="stageListOptions" id="stageList" placeholder="请选择阶段"
                               style="width: 100px;" th:value="${searchValue.getStageName()}">
                        <datalist id="stageListOptions">

                        </datalist>
                        <select class="form-control" id="typeList">
                            <option value="0">请选择题型</option>
                            <option th:each="type:${typeList}" th:value="${type.id}"
                                    th:selected="${searchValue.getTypeId()==type.id}">[[${type.name}]]
                            </option>
                        </select>
                        <select class="form-control" id="levelList">
                            <option value="0">请选择难度</option>
                            <option th:each="level:${levelList}" th:value="${level.id}"
                                    th:selected="${searchValue.getLevelId()==level.id}">[[${level.name}]]
                            </option>
                        </select>
                        <button class="btn btn-outline-secondary" type="button" id="button-addon2" title="搜索题库"
                                onclick="getTopicList(null,this)">
                            <svg t="1642870685872" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                 xmlns="http://www.w3.org/2000/svg" p-id="3506"
                                 width="16" height="16">
                                <path d="M976.948381 946.888761 749.532905 719.473285c28.916587-32.756031 52.169173-69.64622 69.236897-109.999276 21.116947-49.925063 31.823799-102.94358 31.823799-157.581991s-10.706853-107.657952-31.823799-157.581991c-20.390399-48.208978-49.575092-91.498924-86.745666-128.668475s-80.46052-66.355267-128.668475-86.745666C553.430598 57.778938 500.413104 47.072085 445.773669 47.072085c-54.639434 0-107.657952 10.706853-157.581991 31.823799-48.207955 20.390399-91.498924 49.576115-128.668475 86.745666-37.169551 37.169551-66.355267 80.459496-86.745666 128.668475C51.66059 344.234065 40.953737 397.252583 40.953737 451.892017S51.66059 559.548946 72.777537 609.474009c20.390399 48.207955 49.576115 91.498924 86.745666 128.668475 37.169551 37.169551 80.46052 66.35629 128.668475 86.74669 49.925063 21.116947 102.94358 31.823799 157.581991 31.823799 54.639434 0 107.657952-10.706853 157.583015-31.823799 40.352033-17.067724 77.242222-40.320311 109.998253-69.236897l227.415476 227.415476c4.995781 4.995781 11.541871 7.492648 18.090007 7.492648s13.094226-2.496867 18.090007-7.492648C986.938919 973.07619 986.938919 956.878277 976.948381 946.888761zM445.773669 805.546639c-94.464465 0-183.275163-36.786835-250.071476-103.58417-66.796312-66.795289-103.583147-155.605987-103.583147-250.071476 0-94.464465 36.786835-183.275163 103.583147-250.071476 66.796312-66.796312 155.60701-103.583147 250.071476-103.583147s183.275163 36.786835 250.071476 103.583147c66.796312 66.796312 103.583147 155.60701 103.583147 250.071476 0 92.640933-35.400255 179.829691-99.768261 246.163469-1.515516 0.974188-2.953262 2.118244-4.278443 3.444449-1.325182 1.325182-2.469238 2.762927-3.443425 4.27742C625.602338 770.145361 538.41358 805.546639 445.773669 805.546639z"
                                      p-id="3507"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                <hr style="margin: 0">
                <div class="right-list" style="padding: 0px 40px;">
                    <div style="color: #b2b2b2;margin: 200px auto;font-size: 23px;width: 340px"
                         th:if="${#lists.isEmpty(topicList)}">暂无相关题库数据，请<a href="" data-bs-toggle="modal"
                                                                           data-bs-target="#addModal"
                                                                           style="color: #53a4f4; text-decoration: none">点击</a>添加...
                    </div>
                    <table class="table table-hover" th:if="${not #lists.isEmpty(topicList)}">
                        <caption>
                            共 [[${pageInfo.getPages()}]] 页 [[${pageInfo.getTotal()}]] 条数据，当前为第
                            [[${pageInfo.getPageNum()}]]
                            页
                        </caption>
                        <thead>
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">题目</th>
                            <th scope="col">类型</th>
                            <th scope="col">难度</th>
                            <th scope="col">阶段</th>
                            <th scope="col">课程</th>
                            <th scope="col">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="topic:${topicList}">
                            <th scope="row" th:text="${topic.getId()}"></th>
                            <td th:text="${#strings.abbreviate(topic.getTitle(),20)}"></td>
                            <td th:text="${topic.getType().getName()}"></td>
                            <td th:text="${topic.getLevel().getName()}"></td>
                            <td th:text="${topic.getStage().getName()}"></td>
                            <td th:text="${topic.getStage().getCourse().getName()}"></td>
                            <td>
                                <div class="btn-group" role="group" aria-label="First group">
                                    <button class="btn btn-outline-secondary" title="查看详情" data-bs-toggle="modal"
                                            data-bs-target="#getModal"
                                            th:onclick="getThisTopic([[${topic.id}]],[[${topic.code}]])">
                                        <svg t="1645547346995" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                             xmlns="http://www.w3.org/2000/svg" p-id="3000" width="17" height="21">
                                            <path d="M262.4 288m-57.6 0a57.6 57.6 0 1 0 115.2 0 57.6 57.6 0 1 0-115.2 0Z"
                                                  p-id="3001"></path>
                                            <path d="M262.4 518.4m-57.6 0a57.6 57.6 0 1 0 115.2 0 57.6 57.6 0 1 0-115.2 0Z"
                                                  p-id="3002"></path>
                                            <path d="M262.4 748.8m-57.6 0a57.6 57.6 0 1 0 115.2 0 57.6 57.6 0 1 0-115.2 0Z"
                                                  p-id="3003"></path>
                                            <path d="M790.656 249.6a38.4 38.4 0 0 1 3.6864 76.6208l-3.6864 0.1792h-378.112a38.4 38.4 0 0 1-3.6864-76.6208l3.6864-0.1792h378.112zM790.656 480a38.4 38.4 0 0 1 3.6864 76.6208l-3.6864 0.1792h-378.112a38.4 38.4 0 0 1-3.6864-76.6208l3.6864-0.1792h378.112zM790.656 710.4a38.4 38.4 0 0 1 3.6864 76.6208l-3.6864 0.1792h-378.112a38.4 38.4 0 0 1-3.6864-76.6208l3.6864-0.1792h378.112z"
                                                  p-id="3004"></path>
                                        </svg>
                                    </button>
                                    <!--<button class="btn btn-outline-secondary" title="编辑" data-bs-toggle="modal"
                                            data-bs-target="#editModal"
                                            th:onclick="getEditTopic([[${topic.id}]],[[${topic.code}]])">
                                        <svg t="1643124454553" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                             xmlns="http://www.w3.org/2000/svg" p-id="4042"
                                             width="16" height="16">
                                            <path d="M76.094377 995.097685c-8.806174 0-17.612348-3.612789-23.93473-9.935171a34.547299 34.547299 0 0 1-9.709371-27.32172l26.192723-267.120618c0.451599-43.579272 18.515546-86.029548 49.450055-116.738258L544.176406 151.285557c13.322161-13.096362 34.547299-13.096362 47.869459 0l296.926131 296.92613a33.847321 33.847321 0 0 1 0 47.86946l-426.76075 423.373759a165.917354 165.917354 0 0 1-115.835061 48.546858l-266.894818 27.095921h-3.38699zM567.885336 223.089746L165.736714 622.077178c-18.741345 18.515546-29.353914 44.25667-29.353914 70.449393 0 1.128997 0 2.257993-0.225799 3.38699l-22.128335 227.379934 227.379934-23.031532c1.128997-0.225799 2.257993-0.225799 3.38699-0.2258 26.418523 0 51.25645-10.16097 69.997795-28.902315L817.167806 471.920617 567.885336 223.089746zM102.5129 692.526571z"
                                                  fill="#2c2c2c" p-id="4043"></path>
                                            <path d="M865.037266 506.016318c-9.031974 0-17.612348-3.612789-23.93473-9.935171L544.402205 199.606615a33.644101 33.644101 0 0 1 0-47.86946l93.480926-93.480926a98.267872 98.267872 0 0 1 138.640794 0l204.122602 204.122602c18.967144 18.967144 29.579713 44.25667 29.579713 71.126792s-10.38677 52.159647-29.579713 71.126792l-91.448732 91.448732c-6.548181 6.322381-15.354355 9.935171-24.160529 9.935171zM616.206395 175.671885L864.811466 424.276957l67.514003-67.514002c6.322381-6.322381 9.709372-14.451158 9.709371-23.257332s-3.38699-16.93495-9.709371-23.257332L728.428666 106.125689a30.257111 30.257111 0 0 0-42.676075 0l-69.546196 69.546196z"
                                                  fill="#2c2c2c" p-id="4044"></path>
                                        </svg>
                                    </button>-->
                                    <button class="btn btn-outline-secondary" title="删除"
                                            th:onclick="delTopic([[${topic.id}]],[[${topic.code}]])">
                                        <svg t="1643123690316" class="icon" viewBox="0 0 1024 1024" version="1.1"
                                             xmlns="http://www.w3.org/2000/svg" p-id="2260"
                                             width="16" height="16">
                                            <path d="M742.4 944H281.6c-49.4 0-89.6-43.1-89.6-96V368h64v480c0 17.3 11.7 32 25.6 32h460.8c13.9 0 25.6-14.7 25.6-32V368h64v480c0 52.9-40.2 96-89.6 96z"
                                                  p-id="2261"></path>
                                            <path d="M384 368h64v416h-64zM592 368h64v416h-64zM64 224h896v64H64z"
                                                  p-id="2262"></path>
                                            <path d="M768 288H256V160c0-52.9 43.1-96 96-96h320c52.9 0 96 43.1 96 96v128z m-448-64h384v-64c0-17.6-14.4-32-32-32H352c-17.6 0-32 14.4-32 32v64z"
                                                  p-id="2263"></path>
                                        </svg>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <nav aria-label="Page navigation example" th:if="${not #lists.isEmpty(topicList)}">
                        <ul class="pagination justify-content-center" style="margin: 0;">
                            <li th:class="${pageInfo.getFirstPage()==pageInfo.getPageNum()?'page-item disabled':'page-item'}"
                                th:onclick="getTopicList([[${pageInfo.getPrePage()}]],this)">
                                <a class="page-link" href="#">&laquo;</a>
                            </li>
                            <li th:class="${pageInfo.getPageNum()==1?'page-item disabled':'page-item'}"
                                th:onclick="getTopicList([[${pageInfo.getFirstPage()}]],this)">
                                <a class="page-link" href="#">首页</a>
                            </li>
                            <li th:class="${pageInfo.getLastPage()==pageInfo.getPageNum()?'page-item disabled':'page-item'}"
                                th:onclick="getTopicList([[${pageInfo.getLastPage()}]],this)">
                                <a class="page-link" href="#">末页</a>
                            </li>
                            <li th:class="${pageInfo.getLastPage()==pageInfo.getPageNum()?'page-item disabled':'page-item'}"
                                th:onclick="getTopicList([[${pageInfo.getNextPage()}]],this)">
                                <a class="page-link" href="#">&raquo;</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- 查看详情Modal -->
<div class="modal fade" id="getModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="getModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="getModalLabel">题目详情</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="topicInfoDiv" style="font-size: 18px">

            </div>
        </div>
    </div>
</div>
<!-- 添加题目Modal -->
<div class="modal fade" id="addModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="addModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable" style="min-width: 1200px;">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addModalLabel">添加题目</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="new_topic_form" name="new_topic_form">
                    <div class="topicDiv">
                        <div class="new_select_div">
                            <hr>
                            <br>
                            <div class="mb-3">
                                <select class="form-select" name="typeId" onchange="changeTopicDiv(this)">
                                    <option value="0">请选择录入题目的题型</option>
                                    <option th:each="type:${typeList}" th:value="${type.id}">[[${type.name}]]
                                    </option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <select class="form-select" name="levelId">
                                    <option value="0">请选择录入题目的难度</option>
                                    <option th:each="level:${levelList}" th:value="${level.id}">[[${level.name}]]
                                    </option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <input class="form-select new_courseList" list="new_courseListOptions0"
                                       placeholder="请选择录入题目的课程">
                                <datalist id="new_courseListOptions0">
                                    <option th:each="course:${courseList}" th:value="${course.name}"
                                            th:data-value="${course.id+'&'+course.code}"></option>
                                </datalist>
                            </div>
                            <div class="mb-3">
                                <select class="form-select" name="stageId">
                                    <option value="0">请选择录入题目的阶段</option>
                                </select>
                                <!--<input class="form-select new_stageList" list="new_stageListOptions0" name="stageId"
                                       placeholder="请选择录入题目的课程阶段">
                                <datalist id="new_stageListOptions0">

                                </datalist>-->
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="addMoreTopic()">批量</button>
                <button type="button" class="btn btn-primary" onclick="addTopics()">添加</button>
            </div>
        </div>
    </div>
</div>
<!-- 更新题目Modal -->
<!--<div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editModalLabel">编辑课程信息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="edit_course_form">
                    <div class="div">
                        <label class="div1">课程名称</label>
                        <div class="div2">
                            <input type="hidden" id="edit_id" name="id">
                            <input type="text" id="edit_name" class="form-control" name="name"
                                   placeholder="请输入学院名称">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="editCollege()">更新</button>
            </div>
        </div>
    </div>
</div>-->
<script th:src="@{/js/jquery-3.3.1.min.js}"></script>
<script th:src="@{/bootstrapv5/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/common.js}"></script>
<script>
    $(document).ready(function () {
        if ($("#courseListOptions").children().length === 0) {
            alert("您还未创建任何课程，请前往课程管理创建！");
        } else {
            //搜索时返回搜索值的处理
            if ($("#courseList").val() !== "" && $("#courseList").val() !== null) {
                var value = $('#courseListOptions [value="' + $("#courseList").val() + '"]').data('value');
                var courseId = parseInt(value.substring(0, value.indexOf('&')));
                var courseCode = value.substring(value.indexOf('&') + 1);
                $.post("[[@{/stage/list}]]", {"courseId": courseId, "code": courseCode}, function (d) {
                    if (d.data.length > 0) {
                        for (var i = 0; i < d.data.length; i++) {
                            $("#stageListOptions").append("<option value='" + d.data[i].name + "' data-value='" + d.data[i].id + "'></option>");
                        }
                    }
                });
            }
        }
    });

    /*$(document).ready(function () {
        var data = {};
        $("#courseListOptions option").each(function (i, el) {
            data[$(el).data("value")] = $(el).val();
        });
        console.log(data, $("#courseListOptions option").val());
    });*/

    $("#courseList").change(function () {
        var courseName = $(this).val();
        var value = $('#courseListOptions [value="' + courseName + '"]').data('value');
        if (value !== undefined) {
            var courseId = parseInt(value.substring(0, value.indexOf('&')));
            var courseCode = value.substring(value.indexOf('&') + 1);
            $.post("[[@{/stage/list}]]", {"courseId": courseId, "code": courseCode}, function (d) {
                if (d.data.length > 0) {
                    $("#stageList").val("");
                    $("#stageListOptions").html("");
                    for (var i = 0; i < d.data.length; i++) {
                        $("#stageListOptions").append("<option value='" + d.data[i].name + "' data-value='" + d.data[i].id + "'></option>");
                    }
                } else {
                    $("#stageList").val("");
                    $("#stageListOptions").html("");
                    alert("《" + courseName + "》下没有任何阶段，请前往课程管理创建！");
                }
            });
        } else {
            $("#courseList").val("");
            $("#stageList").val("");
            $("#stageListOptions").html("");
        }
    });

    /*$("#stageList").change(function () {
        var stageName = $(this).val();
        var value = $('#stageListOptions [value="' + stageName + '"]').data('value');
        if (value === undefined) {
            $("#stageList").val("");
        }
    });*/

    function getTopicList(pageNum, obj) {
        if (!$(obj).hasClass('disabled')) {
            var searchValue = "?";
            var courseValue = $('#courseListOptions [value="' + $("#courseList").val() + '"]').data('value');
            var stageValue = $('#stageListOptions [value="' + $("#stageList").val() + '"]').data('value');
            var typeId = $("#typeList").val();
            var levelId = $("#levelList").val();
            /*console.log(courseValue + " " + stageValue + " " + typeId + " " + levelId)*/
            if (courseValue !== undefined) {
                courseValue = parseInt(courseValue.substring(0, courseValue.indexOf('&')));
                searchValue += "courseId=" + courseValue + "&courseName=" + encodeURIComponent($("#courseList").val());
            }
            if (stageValue !== undefined) {
                if (courseValue !== undefined) {
                    searchValue += "&stageId=" + stageValue + "&stageName=" + encodeURIComponent($("#stageList").val());
                } else {
                    searchValue += "stageId=" + stageValue + "&stageName=" + encodeURIComponent($("#stageList").val());
                }
            }
            if (typeId !== "0") {
                if (stageValue !== undefined) {
                    searchValue += "&typeId=" + typeId;
                } else {
                    if (courseValue !== undefined) {
                        searchValue += "&typeId=" + typeId;
                    } else {
                        searchValue += "typeId=" + typeId;
                    }
                }
            }
            if (levelId !== "0") {
                if (typeId !== "0") {
                    searchValue += "&levelId=" + levelId;
                } else {
                    searchValue += "levelId=" + levelId;
                }
            }
            searchValue = searchValue === "?" ? "" : searchValue;
            console.log(searchValue);
            if (pageNum == null) {
                window.location.href = "[[@{/topic/search}]]" + searchValue;
            } else {
                if(searchValue===""){
                    window.location.href = "[[@{/topic/search}]]" + "?pageNum=" + pageNum;
                }else{
                    window.location.href = "[[@{/topic/search}]]" + searchValue + "&pageNum=" + pageNum;
                }
            }
        }
    }

    $(document).on("change",".new_courseList",function (){
        var courseName = $(this).val();
        var index = $(".new_courseList").index($(this));
        var idName = $(this).next().attr("id");
        var value = $('#' + idName + ' [value="' + courseName + '"]').data('value');
        if (value !== undefined) {
            var courseId = parseInt(value.substring(0, value.indexOf('&')));
            var courseCode = value.substring(value.indexOf('&') + 1);
            var currentDom = $(this);
            $.post("[[@{/stage/list}]]", {"courseId": courseId, "code": courseCode}, function (d) {
                if (d.data.length > 0) {
                    /*currentDom.parent().next().children("input.new_stageList").val("");
                    currentDom.parent().next().children("datalist").html("");*/
                    currentDom.parent().next().children("select").html("<option value=\"0\">请选择录入题目的阶段</option>");
                    for (var i = 0; i < d.data.length; i++) {
                        //currentDom.parent().next().children("datalist").append("<option value='" + d.data[i].name + "' data-value='" + d.data[i].id + "'></option>");
                        currentDom.parent().next().children("select").append("<option value='" + d.data[i].id + "'>"+d.data[i].name+"</option>");
                    }
                } else {
                    /*currentDom.parent().next().children("input.new_stageList").val("");
                    currentDom.parent().next().children("datalist").html("");*/
                    currentDom.parent().next().children("select").html("<option value=\"0\">请选择录入题目的阶段</option>");
                    alert("《" + courseName + "》下没有任何阶段，请前往课程管理创建！");
                }
            });
        } else {
            $(this).val("");
            /*$(this).parent().next().children("input.new_stageList").val("");
            $(this).parent().next().children("datalist").html("");*/
            $(this).parent().next().children("select").html("<option value=\"0\">请选择录入题目的阶段</option>");
            if ($(this).next().children().length===0) {
                alert("您还未创建任何课程，请前往课程管理创建！");
            }
        }
    })

    /*$(document).on("change",".new_stageList",function (){
        var stageName = $(this).val();
        var idName = $(this).next().attr("id");
        var value = $('#' + idName + ' [value="' + stageName + '"]').data('value');
        if (value === undefined) {
            $(this).val("");
        }
    });*/

    //更多单选题选项及答案
    function addSingleChoiceOpt(obj) {
        var length = $(obj).closest(".singleChoiceOptsDiv").children().length;
        if (length > 7) {
            alert("选项不能再多了哦！");
        } else {
            var optIndex = String.fromCharCode(65 + length);
            $(obj).closest(".singleChoiceOptsDiv").append("<div class=\"mb-3\">\n" +
                "                            <h6>选项" + optIndex + ":</h6>\n" +
                "                            <div class='input-group'><textarea class=\"form-control\" name=\"single_choice_opt\"></textarea><input class=\"btn btn-outline-secondary\" onclick=\"delOpt(this)\" type=\"button\" value=\"X\" title='删除该选项'></div>\n" +
                "                        </div>");
            /*var idIndex = document.new_topic_form.single_choice_answer.length;
            $(obj).parent().parent().next().find(".choiceAnswerDiv").append("<div class=\"form-check form-check-inline\">\n" +
                "                                    <input class=\"form-check-input\" type=\"radio\" name=\"single_choice_answer\"\n" +
                "                                           id=\"single_choice_answer" + (idIndex + 1) + "\"\n" +
                "                                           value=\"" + optIndex + "\">\n" +
                "                                    <label class=\"form-check-label\" for=\"single_choice_answer" + (idIndex + 1) + "\">" + optIndex + "</label>\n" +
                "                                </div>");*/
            $(obj).parent().parent().next().find(".choiceAnswerDiv").append("<div class=\"form-check form-check-inline\">\n" +
                "                                    <input class=\"form-check-input newSingleChoiceAnswer\" onclick=\"checkOne(this)\" type=\"checkbox\" name=\"single_choice_answer\"\n" +
                "                                           value=\"" + optIndex + "\">\n" +
                "                                    <label class=\"form-check-label\">" + optIndex + "</label>\n" +
                "                                </div>");
        }
    }

    //更多多选题选项及答案
    function addMoreChoiceOpt(obj) {
        var length = $(obj).closest(".moreChoiceOptsDiv").children().length;
        if (length > 7) {
            alert("选项不能再多了哦！");
        } else {
            var optIndex = String.fromCharCode(65 + length);
            $(obj).closest(".moreChoiceOptsDiv").append("<div class=\"mb-3\">\n" +
                "                            <h6>选项" + optIndex + ":</h6>\n" +
                "                            <div class='input-group'><textarea class=\"form-control\" name=\"more_choice_opt\"></textarea><input class=\"btn btn-outline-secondary\" onclick=\"delOpt(this)\" type=\"button\" value=\"X\" title='删除该选项'></div>\n" +
                "                        </div>");
            /*var idIndex = document.new_topic_form.more_choice_answer.length;
            $(obj).parent().parent().next().find(".choiceAnswerDiv").append("<div class=\"form-check form-check-inline\">\n" +
                "                                    <input class=\"form-check-input\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                           id=\"more_choice_answer" + (idIndex + 1) + "\"\n" +
                "                                           value=\"" + optIndex + "\">\n" +
                "                                    <label class=\"form-check-label\" for=\"more_choice_answer" + (idIndex + 1) + "\">" + optIndex + "</label>\n" +
                "                                </div>");*/
            $(obj).parent().parent().next().find(".choiceAnswerDiv").append("<div class=\"form-check form-check-inline\">\n" +
                "                                    <input class=\"form-check-input newMoreChoiceAnswer\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                           value=\"" + optIndex + "\">\n" +
                "                                    <label class=\"form-check-label\">" + optIndex + "</label>\n" +
                "                                </div>");
        }
    }

    //删除选项及答案
    function delOpt(obj) {
        var index = $(".new_opts_div").index($(obj).closest(".new_opts_div")); //当前new_opts_div的索引
        $(obj).closest(".new_opts_div").next().find(".choiceAnswerDiv").children("div:last-child").remove();  //删除当前选项
        $(obj).parent().parent().remove();   //删除对应答案
        var optsDocument = $(".new_opts_div:eq(" + index + ")").children();
        var length = optsDocument.length;
        if (length > 4) {
            //更改选项索引
            for (var i = 4; i < length; i++) {
                optsDocument[i].children.item(0).innerText = "选项" + String.fromCharCode(65 + i) + ":";
            }
        }
    }

    //添加更多填空答案
    function addMoreEmpty(obj) {
        if ($(obj).parent().parent().children().length > 4) {
            alert("一道填空题不能超过5个空哦！");
        } else {
            $(obj).parent().parent().append("<div class=\"mb-3\">\n" +
                "                      <h6>填空答案:</h6>\n" +
                "                      <div class=\"input-group\">\n" +
                "                        <textarea class=\"form-control\" name=\"fillEmpty_answer\"></textarea>\n" +
                "                        <input type=\"button\" class=\"btn btn-outline-secondary\" value=\"X\" onclick=\"delOpt(this)\" title=\"删除该填空答案\">\n" +
                "                      </div>\n" +
                "                    </div>");
        }
    }

    function dropTopicDiv(obj){
        var className = $(obj).closest(".new_select_div").next().attr("class");
        if(className !== undefined && className.indexOf("TopicDiv")!==-1){
            $(obj).closest(".new_select_div").next().remove();
            //题号重新排序
            for(var i = 0; i<$(".choiceTopicDiv").length; i++){
                $(".choiceTopicDiv:eq("+i+")").find("h5:eq(0)").text("单选题"+(i+1));
            }
            for(var i = 0; i<$(".moreChoiceTopicDiv").length; i++){
                $(".moreChoiceTopicDiv:eq("+i+")").find("h5:eq(0)").text("多选题"+(i+1));
            }
            for(var i = 0; i<$(".trueFalseTopicDiv").length; i++){
                $(".trueFalseTopicDiv:eq("+i+")").find("h5:eq(0)").text("判断题"+(i+1));
            }
            for(var i = 0; i<$(".fillEmptyTopicDiv").length; i++){
                $(".fillEmptyTopicDiv:eq("+i+")").find("h5:eq(0)").text("填空题"+(i+1));
            }
            for(var i = 0; i<$(".subjectiveTopicDiv").length; i++){
                $(".subjectiveTopicDiv:eq("+i+")").find("h5:eq(0)").text("主观题"+(i+1));
            }
        }
        $(obj).closest(".new_select_div").remove();
    }

    function changeTopicDiv(obj){
        //console.log($(obj).closest(".topicDiv").children().length);
        if($(obj).closest(".topicDiv").children().length>1){
            $(obj).closest(".topicDiv").children().last().remove();
        }
        var type = $(obj).val();
        if(type==="1"){
            //单选题
            $(obj).closest(".topicDiv").append("<div class=\"choiceTopicDiv\">\n" +
                "                        <div class=\"mb-3\">\n" +
                "                            <h5 align=\"center\">单选题</h5>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_title_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>题目内容:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"single_choice_title\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <input type=\"hidden\" name=\"opts\"/>\n" +
                "                        <div class=\"new_opts_div singleChoiceOptsDiv\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项A:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"single_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项B:</h6>\n" +
                "                                <a href=\"javascript:void(0)\" onclick=\"addSingleChoiceOpt(this)\" style=\"left: 87%\"\n" +
                "                                   title=\"更多选项\">\n" +
                "                                    <svg t=\"1646250752287\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\"\n" +
                "                                         xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5589\"\n" +
                "                                         width=\"20\" height=\"20\">\n" +
                "                                        <path d=\"M511.5 957.9C264.9 957.9 65 758.2 65 511.9s199.9-446 446.5-446S958 265.6 958 511.9c0.1 246.3-199.8 446-446.5 446zM509 149.1c-200.4 0-355.8 162.2-355.8 362.3 0 200.1 155.4 356.8 355.8 356.8s362.9-156.7 362.9-356.8c0-200.1-162.5-362.3-362.9-362.3zM690.5 556h-134v133.8c0 24.6-20 44.6-44.6 44.6h-0.1c-24.6 0-44.6-19.9-44.6-44.6V556h-134c-24.7 0-44.6-19.9-44.6-44.5v-0.1c0-24.6 20-44.6 44.6-44.6h134V333c0-24.6 20-44.6 44.6-44.6h0.1c24.7 0 44.6 19.9 44.6 44.6v133.8h134c24.7 0 44.6 19.9 44.6 44.6v0.1c0 24.6-19.9 44.5-44.6 44.5z m0 0\"\n" +
                "                                              fill=\"#1296db\" p-id=\"5590\"></path>\n" +
                "                                    </svg>\n" +
                "                                </a>\n" +
                "                                <textarea class=\"form-control\" name=\"single_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项C:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"single_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项D:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"single_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_answer_div\">\n" +
                "                            <div class=\"mb-3\" align=\"center\">\n" +
                "                                <h6>参考答案:</h6>\n" +
                "                                <div class=\"choiceAnswerDiv\">\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newSingleChoiceAnswer\" onclick=\"checkOne(this)\" type=\"checkbox\" name=\"single_choice_answer\"\n" +
                "                                                value=\"A\">\n" +
                "                                        <label class=\"form-check-label\">A</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newSingleChoiceAnswer\" onclick=\"checkOne(this)\" type=\"checkbox\" name=\"single_choice_answer\"\n" +
                "                                                value=\"B\">\n" +
                "                                        <label class=\"form-check-label\">B</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newSingleChoiceAnswer\" onclick=\"checkOne(this)\" type=\"checkbox\" name=\"single_choice_answer\"\n" +
                "                                                value=\"C\">\n" +
                "                                        <label class=\"form-check-label\">C</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newSingleChoiceAnswer\" onclick=\"checkOne(this)\" type=\"checkbox\" name=\"single_choice_answer\"\n" +
                "                                               value=\"D\">\n" +
                "                                        <label class=\"form-check-label\">D</label>\n" +
                "                                    </div>\n" +
                "                                </div>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\" style=\"margin-left: 17px;width: 97%\">\n" +
                "                                <h6>解析:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"analysis\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <br>\n" +
                "                    </div>");
        }else if(type==="2"){
            //多选题
            $(obj).closest(".topicDiv").append("<div class=\"moreChoiceTopicDiv\">\n" +
                "                        <div class=\"mb-3\">\n" +
                "                            <h5 align=\"center\">多选题</h5>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_title_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>题目内容:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"more_choice_title\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <input type=\"hidden\" name=\"opts\"/>\n" +
                "                        <div class=\"new_opts_div moreChoiceOptsDiv\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项A:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"more_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项B:</h6>\n" +
                "                                <a href=\"javascript:void(0)\" onclick=\"addMoreChoiceOpt(this)\" style=\"left: 87%\"\n" +
                "                                   title=\"更多选项\">\n" +
                "                                    <svg t=\"1646250752287\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\"\n" +
                "                                         xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5589\"\n" +
                "                                         width=\"20\" height=\"20\">\n" +
                "                                        <path d=\"M511.5 957.9C264.9 957.9 65 758.2 65 511.9s199.9-446 446.5-446S958 265.6 958 511.9c0.1 246.3-199.8 446-446.5 446zM509 149.1c-200.4 0-355.8 162.2-355.8 362.3 0 200.1 155.4 356.8 355.8 356.8s362.9-156.7 362.9-356.8c0-200.1-162.5-362.3-362.9-362.3zM690.5 556h-134v133.8c0 24.6-20 44.6-44.6 44.6h-0.1c-24.6 0-44.6-19.9-44.6-44.6V556h-134c-24.7 0-44.6-19.9-44.6-44.5v-0.1c0-24.6 20-44.6 44.6-44.6h134V333c0-24.6 20-44.6 44.6-44.6h0.1c24.7 0 44.6 19.9 44.6 44.6v133.8h134c24.7 0 44.6 19.9 44.6 44.6v0.1c0 24.6-19.9 44.5-44.6 44.5z m0 0\"\n" +
                "                                              fill=\"#1296db\" p-id=\"5590\"></path>\n" +
                "                                    </svg>\n" +
                "                                </a>\n" +
                "                                <textarea class=\"form-control\" name=\"more_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项C:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"more_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>选项D:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"more_choice_opt\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_answer_div\">\n" +
                "                            <div class=\"mb-3\" align=\"center\">\n" +
                "                                <h6>参考答案:</h6>\n" +
                "                                <div class=\"choiceAnswerDiv\" id=\"answer_radio\">\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newMoreChoiceAnswer\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                                value=\"A\">\n" +
                "                                        <label class=\"form-check-label\">A</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newMoreChoiceAnswer\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                                value=\"B\">\n" +
                "                                        <label class=\"form-check-label\">B</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newMoreChoiceAnswer\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                                value=\"C\">\n" +
                "                                        <label class=\"form-check-label\">C</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newMoreChoiceAnswer\" type=\"checkbox\" name=\"more_choice_answer\"\n" +
                "                                                value=\"D\">\n" +
                "                                        <label class=\"form-check-label\">D</label>\n" +
                "                                    </div>\n" +
                "                                </div>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\" style=\"margin-left: 17px;width: 97%\">\n" +
                "                                <h6>解析:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"analysis\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <br>\n" +
                "                    </div>");
        }else if(type==="3"){
            //判断题
            $(obj).closest(".topicDiv").append("<div class=\"trueFalseTopicDiv\">\n" +
                "                        <div class=\"mb-3\">\n" +
                "                            <h5 align=\"center\">判断题</h5>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_title_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>题目内容:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"estimate_title\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_answer_div\">\n" +
                "                            <div class=\"mb-3\" align=\"center\">\n" +
                "                                <h6>参考答案:</h6>\n" +
                "                                <div class='estimateAnswerDiv'>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newEstimateAnswer\" type=\"checkbox\" onclick=\"checkOne(this)\" name=\"estimate_answer\"\n" +
                "                                                value=\"true\">\n" +
                "                                        <label class=\"form-check-label\">对</label>\n" +
                "                                    </div>\n" +
                "                                    <div class=\"form-check form-check-inline\">\n" +
                "                                        <input class=\"form-check-input newEstimateAnswer\" type=\"checkbox\" onclick=\"checkOne(this)\" name=\"estimate_answer\"\n" +
                "                                                value=\"flase\">\n" +
                "                                        <label class=\"form-check-label\">错</label>\n" +
                "                                    </div>\n" +
                "                                </div>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\" style=\"margin-left: 17px;width: 97%\">\n" +
                "                                <h6>解析:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"analysis\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <br>\n" +
                "                    </div>");
        }else if(type==="4"){
            //填空题
            $(obj).closest(".topicDiv").append("<div class=\"fillEmptyTopicDiv\">\n" +
                "                        <div class=\"mb-3\">\n" +
                "                            <h5 align=\"center\">填空题</h5>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_title_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>题目内容:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"fillEmpty_title\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_answer_div\">\n" +
                "                            <div>\n" +
                "                                <div class=\"mb-3\">\n" +
                "                                    <h6>填空答案:</h6>\n" +
                "                                    <a href=\"javascript:void(0)\" onclick=\"addMoreEmpty(this)\" style=\"left: 92%\"\n" +
                "                                       title=\"更多填空答案\">\n" +
                "                                        <svg t=\"1646250752287\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\"\n" +
                "                                             xmlns=\"http://www.w3.org/2000/svg\" p-id=\"5589\"\n" +
                "                                             width=\"20\" height=\"20\">\n" +
                "                                            <path d=\"M511.5 957.9C264.9 957.9 65 758.2 65 511.9s199.9-446 446.5-446S958 265.6 958 511.9c0.1 246.3-199.8 446-446.5 446zM509 149.1c-200.4 0-355.8 162.2-355.8 362.3 0 200.1 155.4 356.8 355.8 356.8s362.9-156.7 362.9-356.8c0-200.1-162.5-362.3-362.9-362.3zM690.5 556h-134v133.8c0 24.6-20 44.6-44.6 44.6h-0.1c-24.6 0-44.6-19.9-44.6-44.6V556h-134c-24.7 0-44.6-19.9-44.6-44.5v-0.1c0-24.6 20-44.6 44.6-44.6h134V333c0-24.6 20-44.6 44.6-44.6h0.1c24.7 0 44.6 19.9 44.6 44.6v133.8h134c24.7 0 44.6 19.9 44.6 44.6v0.1c0 24.6-19.9 44.5-44.6 44.5z m0 0\"\n" +
                "                                                  fill=\"#1296db\" p-id=\"5590\"></path>\n" +
                "                                        </svg>\n" +
                "                                    </a>\n" +
                "                                    <textarea class=\"form-control\" name=\"fillEmpty_answer\"></textarea>\n" +
                "                                </div>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>解析:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"analysis\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <br>\n" +
                "                    </div>");
        }else if(type==="5"){
            //主观题
            $(obj).closest(".topicDiv").append("<div class=\"subjectiveTopicDiv\">\n" +
                "                        <div class=\"mb-3\">\n" +
                "                            <h5 align=\"center\">主观题</h5>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_title_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>题目内容:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"subjective_title\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <div class=\"new_answer_div\">\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>参考答案:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"subjective_answer\"></textarea>\n" +
                "                            </div>\n" +
                "                            <div class=\"mb-3\">\n" +
                "                                <h6>解析:</h6>\n" +
                "                                <textarea class=\"form-control\" name=\"analysis\"></textarea>\n" +
                "                            </div>\n" +
                "                        </div>\n" +
                "                        <br>\n" +
                "                    </div>");
        }
        //题号重新排序
        for(var i = 0; i<$(".choiceTopicDiv").length; i++){
            $(".choiceTopicDiv:eq("+i+")").find("h5:eq(0)").text("单选题"+(i+1));
        }
        for(var i = 0; i<$(".moreChoiceTopicDiv").length; i++){
            $(".moreChoiceTopicDiv:eq("+i+")").find("h5:eq(0)").text("多选题"+(i+1));
        }
        for(var i = 0; i<$(".trueFalseTopicDiv").length; i++){
            $(".trueFalseTopicDiv:eq("+i+")").find("h5:eq(0)").text("判断题"+(i+1));
        }
        for(var i = 0; i<$(".fillEmptyTopicDiv").length; i++){
            $(".fillEmptyTopicDiv:eq("+i+")").find("h5:eq(0)").text("填空题"+(i+1));
        }
        for(var i = 0; i<$(".subjectiveTopicDiv").length; i++){
            $(".subjectiveTopicDiv:eq("+i+")").find("h5:eq(0)").text("主观题"+(i+1));
        }
    }

    //只允许checkbox选中一个
    function checkOne(obj){
        /*console.log($(obj).parent().parent().html());
        alert($(obj).parent().parent().find("input:eq(0)").attr("value"));
        alert($(obj).val()===$(obj).parent().parent().find("input:eq(0)").attr("value"));*/
        var length = $(obj).parent().parent().find("input").length;
        for(var i=0; i<length; i++){
            if($(obj).val()!==$(obj).parent().parent().find("input:eq("+i+")").attr("value")){
                $(obj).parent().parent().find("input:eq("+i+")").prop("checked",false);
            }
        }
    }

    function addTopics(){
        showLoading();
        var formArray = $("#new_topic_form").serializeArray();
        console.log(formArray);
        var topicArray = [];
        var topicObj = {};
        var opts = "";
        var dopts = "";
        var optIndex = 65;
        var isFlag = true;
        $.each(formArray, function (i, item) {
            if (item.name === "typeId") {
                if(item.value==="0"){
                    hideLoading();
                    alert("您有题目未选择题型！");
                    isFlag = false;
                    return false;
                }
                topicObj.typeId = item.value;
            } else if (item.name === "levelId") {
                if(item.value==="0"){
                    hideLoading();
                    alert("您有题目未选择难度！");
                    isFlag = false;
                    return false;
                }
                topicObj.levelId = item.value;
            } else if (item.name === "stageId") {
                if(item.value==="0"){
                    hideLoading();
                    alert("您有题目未选择阶段！");
                    isFlag = false;
                    return false;
                }
                topicObj.stageId = item.value;
            } else if (item.name === "single_choice_title") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有单选题未输入题目内容！");
                    isFlag = false;
                    return false;
                }
                topicObj.title = $.trim(item.value);
            } else if (item.name === "more_choice_title") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有多选题未输入题目内容！");
                    isFlag = false;
                    return false;
                }
                topicObj.title = $.trim(item.value);
            } else if (item.name === "estimate_title") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有判断题未输入题目内容！");
                    isFlag = false;
                    return false;
                }
                topicObj.title = $.trim(item.value);
                topicObj.estimate = true;
            }  else if (item.name === "fillEmpty_title") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有填空题未输入题目内容！");
                    isFlag = false;
                    return false;
                }
                topicObj.title = $.trim(item.value);
            }  else if (item.name === "subjective_title") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有主观题未输入题目内容！");
                    isFlag = false;
                    return false;
                }
                topicObj.title = $.trim(item.value);
            } else if (item.name === "single_choice_opt") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有单选题未输入完整的选项内容！");
                    isFlag = false;
                    return false;
                }
                opts += String.fromCharCode(optIndex) + "." + $.trim(item.value) + "{{separator}}";
                optIndex += 1;
            } else if (item.name === "more_choice_opt") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有多选题未输入完整的选项内容！");
                    isFlag = false;
                    return false;
                }
                dopts += String.fromCharCode(optIndex) + "." + $.trim(item.value) + "{{separator}}";
                optIndex += 1;
            } else if (item.name === "single_choice_answer") {
                topicObj.answer = item.value;
            } else if (item.name === "more_choice_answer") {
                if(topicObj.answer===undefined){
                    topicObj.answer = item.value;
                }else{
                    topicObj.answer += item.value;
                }
            } else if (item.name === "estimate_answer") {
                topicObj.answer = item.value;
            } else if (item.name === "fillEmpty_answer") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有填空题未输入答案！");
                    isFlag = false;
                    return false;
                }
                if(topicObj.answer===undefined){
                    topicObj.answer = $.trim(item.value)+"{{separator}}";
                }else{
                    topicObj.answer += $.trim(item.value)+"{{separator}}";
                }
            } else if (item.name === "subjective_answer") {
                if($.trim(item.value)===""){
                    hideLoading();
                    alert("您有主观题未输入答案！");
                    isFlag = false;
                    return false;
                }
                topicObj.answer = $.trim(item.value);
            }  else if(item.name === "analysis") {
                if(opts!==""){
                    if(topicObj.answer===undefined){
                        hideLoading();
                        alert("您有单选题未输入答案！");
                        isFlag = false;
                        return false;
                    }
                    topicObj.opts = opts;
                    opts = "";
                    optIndex = 65;
                }
                if(dopts!==""){
                    if(topicObj.answer===undefined){
                        hideLoading();
                        alert("您有多选题未输入答案！");
                        isFlag = false;
                        return false;
                    }
                    topicObj.opts = dopts;
                    dopts = "";
                    optIndex = 65;
                }
                if(topicObj.estimate!==undefined){
                    if(topicObj.answer===undefined){
                        hideLoading();
                        alert("您有判断题未输入答案！");
                        isFlag = false;
                        return false;
                    }
                }
                topicObj.analysis = $.trim(item.value);
                topicArray.push(topicObj);
                topicObj = {};
            }
        });
        console.log(topicArray);
        console.log(JSON.stringify(topicArray));
        if(isFlag){
            $.ajax({
                type: "post",
                url: "[[@{/topic/add}]]",
                data: JSON.stringify(topicArray),  //转为Json字符串
                success: function (data, textStatus) {
                    hideLoading();
                    setTimeout(function () {
                        alert(data.msg);
                        if (data.code === 0) {
                            getTopicList([[${pageInfo.getPageNum()}]], null);
                        }
                    }, 300);
                },
                dataType: "json",
                contentType: "application/json"
            });
        }else{
            hideLoading();
        }
    }

    function delTopic(id, code){
        if (confirm("确定从题库中删除这道题吗？")) {
            $.post("[[@{/topic/delete}]]", {"topicId": id, "code": code}, function (data) {
                alert(data.msg);
                if (data.code === 0) {
                    getTopicList([[${pageInfo.getPageNum()}]], null);
                }
            }, "json");
        }
    }

    function getThisTopic(id, code){
        $.post("[[@{/topic/getTopic}]]", {"topicId": id, "code": code}, function (data) {
            if (data.code !== 0) {
                alert(data.msg);
            }else{
                var topicObj = data.data[0];
                $("#topicInfoDiv").html("<hr><h6 align='center'><b>题目内容</b></h6><hr><p>"+topicObj.title+"</p>");
                if(topicObj.typeId===1 || topicObj.typeId===2){
                    var optArray = topicObj.opts.split("{{separator}}");
                    for(var i=0; i<optArray.length-1; i++){
                        $("#topicInfoDiv").append("<p>"+optArray[i]+"</p>");
                    }
                    $("#topicInfoDiv").append("<hr><h6 align='center'><b>参考答案</b></h6><hr><p align='center'>"+topicObj.answer+"</p>");
                }else if(topicObj.typeId===3){
                    $("#topicInfoDiv").append("<hr><h6 align='center'><b>参考答案</b></h6><hr><p align='center'>"+(topicObj.answer==="true"?"<svg t=\"1646507567217\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"6372\" width=\"20\" height=\"20\"><path d=\"M0 0h1024v1024H0V0z\" fill=\"#202425\" opacity=\".01\" p-id=\"6373\"></path><path d=\"M955.733333 512c0 245.077333-198.656 443.733333-443.733333 443.733333S68.266667 757.077333 68.266667 512 266.922667 68.266667 512 68.266667s443.733333 198.656 443.733333 443.733333z\" fill=\"#11AA66\" p-id=\"6374\"></path><path d=\"M512 102.4C285.7984 102.4 102.4 285.7984 102.4 512s183.3984 409.6 409.6 409.6 409.6-183.3984 409.6-409.6S738.2016 102.4 512 102.4zM34.133333 512C34.133333 248.081067 248.081067 34.133333 512 34.133333s477.866667 213.947733 477.866667 477.866667-213.947733 477.866667-477.866667 477.866667S34.133333 775.918933 34.133333 512z\" fill=\"#11AA66\" p-id=\"6375\"></path><path d=\"M787.114667 339.285333a51.2 51.2 0 0 1 0 72.362667l-307.2 307.2a51.2 51.2 0 0 1-72.362667 0l-170.666667-170.666667a51.2 51.2 0 0 1 72.362667-72.362666L443.733333 610.235733l271.018667-271.018666a51.2 51.2 0 0 1 72.362667 0z\" fill=\"#FFFFFF\" p-id=\"6376\"></path></svg>":"<svg t=\"1646507637031\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"8832\" width=\"20\" height=\"20\"><path d=\"M1022.293364 470.409918a511.990827 511.990827 0 1 0-551.883445 551.883446 513.484133 513.484133 0 0 0 551.883445-551.883446zM625.073814 549.768497l100.264871 100.05154A53.332378 53.332378 0 1 1 649.820038 725.338684l-100.051541-100.26487a53.759037 53.759037 0 0 0-75.518647 0L374.198309 725.338684A53.332378 53.332378 0 1 1 298.679662 649.820037l100.264871-100.05154a53.759037 53.759037 0 0 0 0-75.518647L298.679662 374.198309A53.332378 53.332378 0 0 1 374.198309 298.679662l100.051541 100.26487a53.759037 53.759037 0 0 0 75.518647 0l100.051541-100.26487A53.332378 53.332378 0 1 1 725.338685 374.198309l-100.264871 100.051541a53.759037 53.759037 0 0 0 0 75.518647z\" fill=\"#D33737\" p-id=\"8833\"></path></svg>")+"</p>");
                }else if(topicObj.typeId===4){
                    var answerArray = topicObj.answer.split("{{separator}}");
                    for(var i=0; i<answerArray.length-1; i++){
                        $("#topicInfoDiv").append("<hr><h6 align='center'><b>参考答案</b></h6><hr><p align='center'>"+answerArray[i]+"</p>");
                    }
                }else{
                    $("#topicInfoDiv").append("<hr><h6 align='center'><b>参考答案</b></h6><hr><p>"+(topicObj.answer===null?"无":topicObj.answer)+"</p>");

                }
                $("#topicInfoDiv").append("<hr><h6 align='center'><b>题目解析</b></h6><hr><p>"+(topicObj.analysis===null?"无":topicObj.analysis)+"</p>");
            }
        }, "json");
    }
</script>
<script th:inline="javascript">
    var typeList = [
            [# th:each="type:${typeList}"]
                [[${type}]],
            [/]
        ];
    var levelList = [
            [# th:each="level:${levelList}"]
                [[${level}]],
            [/]
        ];
    var courseList = [
            [# th:each="course:${courseList}"]
                {"id":[[${course.id}]],"name":[[${course.name}]],"code":[[${course.code}]]},
            [/]
        ];
    var typeOption = "";
    var levelOption = "";
    var courseOption= "";
    for(var i = 0; i<[[${typeList.size()}]]; i++){
        typeOption += "<option value='"+typeList[i].id+"'>"+typeList[i].name+"</option>"
    }
    for(var j = 0; j<[[${levelList.size()}]]; j++){
        levelOption += "<option value='"+levelList[j].id+"'>"+levelList[j].name+"</option>"
    }
    for(var a = 0; a<[[${courseList.size()}]]; a++){
        courseOption += "<option value='"+courseList[a].name+"' data-value='"+courseList[a].id+"&"+courseList[a].code+"'></option>"
    }
    function addMoreTopic() {
        var idIndex = parseInt($(".new_courseList:last").attr("list").substring(21));
        $("#new_topic_form").append(
            "                    <div class=\"topicDiv\"><div class=\"new_select_div\"><hr><br>\n" +
            "                        <div class=\"mb-3\">\n" +
            "                            <select class=\"form-select\" name=\"typeId\" onchange=\"changeTopicDiv(this)\">\n" +
            "                                <option value=\"0\">请选择录入题目的题型</option>\n" +typeOption+
            "                            </select>\n" +
            "                        </div>\n" +
            "                        <div class=\"mb-3\">\n" +
            "                            <select class=\"form-select\" name=\"levelId\">\n" +
            "                                <option value=\"0\">请选择录入题目的难度</option>\n" +levelOption+
            "                            </select>\n" +
            "                        </div>\n" +
            "                        <div class=\"mb-3\">\n" +
            "                            <input class=\"form-select new_courseList\" list=\"new_courseListOptions"+(idIndex+1)+"\"\n" +
            "                                   placeholder=\"请选择录入题目的课程\">\n" +
            "                            <datalist id=\"new_courseListOptions"+(idIndex+1)+"\">\n" +courseOption+
            "                            </datalist>\n" +
            "                        </div>\n" +
            "                        <div class=\"mb-3\">\n" + "<select class=\"form-select\" name=\"stageId\">\n" +
            "                                    <option value=\"0\">请选择录入题目的阶段</option>\n" +
            "                                </select>" +
            "                        </div>\n<a href=\"javascript:void(0)\" title=\"删除该题目\" onclick=\"dropTopicDiv(this)\">\n" +
            "                            <svg t=\"1646079725352\" class=\"icon\" viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" p-id=\"10602\" width=\"16\" height=\"16\">\n" +
            "                                <path d=\"M1017.6 518.4C1017.6 238.72 791.68 12.8 512 12.8 232.32 12.8 6.4 238.72 6.4 518.4 6.4 798.08 232.32 1024 512 1024c279.68 0 505.6-225.92 505.6-505.6z\" fill=\"#895251\" p-id=\"10603\"></path>\n" +
            "                                <path d=\"M1017.6 505.6C1017.6 225.92 791.68 0 512 0 232.32 0 6.4 225.92 6.4 505.6c0 279.68 225.92 505.6 505.6 505.6 279.68 0 505.6-225.92 505.6-505.6z\" fill=\"#EB786B\" p-id=\"10604\"></path>\n" +
            "                                <path d=\"M729.6 588.8H294.4c-19.2 0-38.4-19.2-38.4-38.4V460.8c0-19.2 19.2-38.4 38.4-38.4h435.2c19.2 0 38.4 19.2 38.4 38.4v89.6c0 19.2-19.2 38.4-38.4 38.4zM294.4 435.2c-12.8 0-25.6 12.8-25.6 25.6v89.6c0 12.8 12.8 19.2 19.2 19.2h435.2c12.8 0 19.2-12.8 19.2-19.2V460.8c0-12.8-12.8-19.2-19.2-19.2H294.4z\" fill=\"#808080\" p-id=\"10605\"></path>\n" +
            "                                <path d=\"M761.6 550.4V460.8c0-19.2-12.8-32-32-32H294.4c-19.2 0-32 12.8-32 32v89.6c0 19.2 12.8 32 32 32h435.2c19.2 0 32-19.2 32-32z\" fill=\"#FBFCFB\" p-id=\"10606\"></path>\n" +
            "                            </svg>\n" +
            "                        </a>" +
            "                    </div></div>");
    }

</script>
</body>

</html>